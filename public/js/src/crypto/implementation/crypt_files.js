/*
* @name: fileEncryption()
* @description: encrypt the file before uploading
* @params: file, cek is the content encryption key and CEK is a bits array
* @dependencies: base64.js
* @note: the CEK is there a passphrase, not a key composed of
* the salt and the secrete password and the iteration
* This system allow us to get a different key for all the files
* even if the params are readable.
* Also, the salt is randomly generated by SJCL.
* The file is encrypted to don't get a bug issue about the binary files encryption
*/

var fileEncryption = function(file, cek)
{
	var cek = base64.decode(cek); //decode the cek stored in a cookie
	var aDATA = sjcl.random.randomWords(1); //generate the authentification tag, returns a bits array
	var aDATA = sjcl.codec.hex.fromBits(aDATA); //encode the bit array to get a hex string
	var cipheredFile = sjcl.encrypt(cek, file,{
		mode:'gcm', iter:2000, ks:256, ts:128, adata:aDATA
	});
	return cipheredFile;
	/*
	* SJCL returns a JSON
	*/
}


/*
* @name: fileDecryption()
* @description: decrypt the file after being downloaded
* @params: file (have to be the JSON returned by the encryption function), cek (is a string)
* @dependencies: base64.js
*/
var fileDecryption = function(file, cek)
{
	var cek = base64.decode(cek); //decoding of the CEK, to use it as a bits array of 256 bits
	var decryptedFile = sjcl.decrypt(cek, file);
	return decryptedFile;
}
